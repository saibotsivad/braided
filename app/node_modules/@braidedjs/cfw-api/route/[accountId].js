import { etagIfNoneMatch } from 'shared/etag-if-none-match.js'
import { getAccount } from 'api-rest/service/get-account.js'
import { NotFoundException } from 'shared/exception/not-found.js'
import { assertUserHasRoles } from 'api-rest/assert-user-has-roles.js'

export const roles = [
	'get:accountId:[accountId]'
]

export const route = {
	path: '/:accountId',
	methods: {
		GET: async (request, { accountId }) => {
			assertUserHasRoles(request, roles, { accountId })

			const account = await getAccount(accountId.toUpperCase())
			if (!account) {
				throw new NotFoundException()
			}
			return etagIfNoneMatch(request, { data: account })
		}
	}
}
