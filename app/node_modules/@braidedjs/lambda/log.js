const levels = {
	debug: 1,
	info: 2,
	warn: 3,
	error: 4
}

const isLocal = process.env.IS_LOCAL === 'true'
const logLevel = levels[process.env.LOG_LEVEL] || levels.info

const logger = level => (message, ...properties) => {
	// if the user sets log level warn (3)
	// any log less than level 3 is dropped
	if (levels[level] < logLevel) return

	if (isLocal) {
		const params = [
			`[${new Date().toISOString()}]`,
			message,
			properties.length
				? JSON.stringify(properties, undefined, 2)
				: ''
		].filter(Boolean)
		console[level](...params)
	} else {
		console[level](JSON.stringify({ message, properties }))
	}
}

export const log = Object
	.keys(levels)
	.reduce((map, level) => {
		map[level] = logger(level)
		return map
	}, {})
